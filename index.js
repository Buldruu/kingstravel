// ================== i18n ==================
const I18N = {
  en: {
    "top.pill": "Mongolia Tours • Support",
    "top.quote": "Get a quote",
    "nav.dest": "Destinations",
    "nav.prov": "21 Provinces",
    "nav.pack": "Packages",
    "nav.serv": "Services",
    "nav.rev": "Reviews",
    "nav.faq": "FAQ",
    "nav.contact": "Contact",

    "hero.h1": "Explore Mongolia with confidence.",
    "hero.lead":
      "Gobi, Khuvsgul, Altai, Terelj, Kharkhorin — private tours, drivers, guidesf, camps, and custom routes.",
    "hero.cta1": "Explore packages",
    "hero.cta2": "See services",
    "hero.stat1": "Routes",
    "hero.stat2": "Client rating",
    "hero.stat3": "Reply time",

    "search.title": "Quick tour search",
    "search.sub": "We’ll propose 2–3 options based on your needs.",
    "search.destLabel": "Destination",
    "search.dateLabel": "Start date",
    "search.styleLabel": "Style",
    "search.styleAny": "Any",
    "search.styleBudget": "Budget",
    "search.styleMid": "Mid-range",
    "search.styleLux": "Premium",
    "search.btn": "Get options",
    "search.tip": "Tip: try “Gobi” + “Mid-range”.",

    "dest.h2": "Top destinations",
    "dest.p": "Most requested routes across Mongolia.",
    "dest.link": "View packages →",

    "prov.h2": "21 Provinces (Aimags)",
    "prov.p": "Browse all provinces — great for planning custom routes.",
    "prov.note": "Note: Ulaanbaatar is a separate municipality (not an aimag).",

    "pkg.h2": "Tour packages",
    "pkg.p": "Filter by type and pick what fits your time and comfort.",
    "pkg.note":
      "Prices are demo placeholders. Replace with your real pricing (USD / MNT).",

    "filter.all": "All",
    "filter.nature": "Nature",
    "filter.culture": "Culture",
    "filter.adventure": "Adventure",
    "filter.family": "Family",

    "serv.h2": "What we provide",
    "serv.p": "Everything for a smooth Mongolia journey — in one place.",
    "serv.s1t": "4x4 & driver",
    "serv.s1p": "Safe vehicles, experienced drivers, long-distance routes.",
    "serv.s2t": "Guides",
    "serv.s2p": "English/Korean speaking guide options available.",
    "serv.s3t": "Camps & stays",
    "serv.s3p": "Ger camps, hotels, and curated stops.",
    "serv.s4t": "Custom itinerary",
    "serv.s4p": "We build routes by season, time, and interests.",

    "cta.h3": "Want a custom plan?",
    "cta.p": "Share dates, budget, and interests — we’ll propose options.",
    "cta.btn": "Request a quote",

    "rev.h2": "Client reviews",
    "rev.p": "Feedback from travelers we helped in Mongolia.",

    "faq.h2": "FAQ",
    "faq.p": "Quick answers before you book.",
    "faq.q1": "Best season to travel Mongolia?",
    "faq.a1":
      "June–September is most popular. Shoulder seasons can be great depending on route and weather.",
    "faq.q2": "Private tour or group tour?",
    "faq.a2":
      "Private tours give you flexibility. Group tours are more budget-friendly. We can offer both.",
    "faq.q3": "Do you provide English/Korean guides?",
    "faq.a3":
      "Yes. Availability depends on dates — book early for peak season.",
    "faq.q4": "What’s included in packages?",
    "faq.a4":
      "Typically: vehicle + driver, fuel, accommodation, and itinerary support. Meals and guide may vary by package.",

    "contact.h2": "Contact",
    "contact.p":
      "Tell us your dates, destinations, number of travelers, and comfort level. We’ll reply with options.",
    "contact.officeT": "Office",
    "contact.officeP": "Ulaanbaatar, Mongolia",
    "contact.phoneT": "Phone",
    "contact.emailT": "Email",
    "contact.formT": "Request a quote",
    "contact.name": "Name",
    "contact.email": "Email",
    "contact.msg": "Message",
    "contact.send": "Send",

    "footer.tagline":
      "Mongolia Tours • Drivers • Guides • Camps • Custom Routes",

    "ui.verified": "Verified traveler",
    "ui.from": "From",
    "ui.book": "Request",
    "ui.topMatches": "Top matches",
    "ui.noMatch":
      "No exact match. Try a broader destination (e.g., “Gobi”) or choose “Any” style.",
    "ui.formReady":
      "Message ready. Connect this form to email/WhatsApp/KakaoTalk to receive leads.",
    "ui.fillAll": "Please fill all fields.",
  },

  ko: {
    "top.pill": "몽골 투어 • 지원",
    "top.quote": "견적 받기",
    "nav.dest": "여행지",
    "nav.prov": "21개 주(아이막)",
    "nav.pack": "패키지",
    "nav.serv": "서비스",
    "nav.rev": "후기",
    "nav.faq": "FAQ",
    "nav.contact": "문의",

    "hero.h1": "안심하고 몽골을 여행하세요.",
    "hero.lead":
      "고비, 홉스골, 알타이, 테렐지, 하르호린 — 프라이빗 투어, 차량/기사, 가이드, 캠프, 맞춤 일정.",
    "hero.cta1": "패키지 보기",
    "hero.cta2": "서비스 보기",
    "hero.stat1": "루트",
    "hero.stat2": "고객 평점",
    "hero.stat3": "응답 시간",

    "search.title": "빠른 투어 검색",
    "search.sub": "원하시는 조건으로 2–3가지 옵션을 제안드립니다.",
    "search.destLabel": "여행지",
    "search.dateLabel": "출발일",
    "search.styleLabel": "스타일",
    "search.styleAny": "전체",
    "search.styleBudget": "가성비",
    "search.styleMid": "중급",
    "search.styleLux": "프리미엄",
    "search.btn": "옵션 받기",
    "search.tip": "팁: “고비” + “중급”으로 검색해 보세요.",

    "dest.h2": "인기 여행지",
    "dest.p": "몽골 내에서 가장 많이 요청되는 루트입니다.",
    "dest.link": "패키지 보기 →",

    "prov.h2": "21개 주(아이막)",
    "prov.p": "전체 아이막을 확인하고 맞춤 루트를 계획하세요.",
    "prov.note": "참고: 울란바토르는 별도의 특별시(아이막 아님)입니다.",

    "pkg.h2": "투어 패키지",
    "pkg.p": "유형별로 필터링해서 일정과 편안함에 맞게 고르세요.",
    "pkg.note": "가격은 예시입니다. 실제 가격(USD/MNT)으로 교체하세요.",

    "filter.all": "전체",
    "filter.nature": "자연",
    "filter.culture": "문화",
    "filter.adventure": "어드벤처",
    "filter.family": "가족",

    "serv.h2": "제공 서비스",
    "serv.p": "몽골 여행을 한 번에 — 차량부터 일정까지.",
    "serv.s1t": "4x4 차량 & 기사",
    "serv.s1p": "안전한 차량, 숙련된 기사, 장거리 루트.",
    "serv.s2t": "가이드",
    "serv.s2p": "영어/한국어 가이드 옵션 가능.",
    "serv.s3t": "캠프 & 숙소",
    "serv.s3p": "게르 캠프, 호텔, 엄선된 숙박.",
    "serv.s4t": "맞춤 일정",
    "serv.s4p": "계절/기간/취향에 맞춰 루트를 구성합니다.",

    "cta.h3": "맞춤 플랜이 필요하신가요?",
    "cta.p": "날짜, 예산, 관심사를 알려주시면 옵션을 제안드립니다.",
    "cta.btn": "견적 요청",

    "rev.h2": "고객 후기",
    "rev.p": "몽골 여행을 도와드린 분들의 실제 피드백입니다.",

    "faq.h2": "자주 묻는 질문",
    "faq.p": "예약 전 꼭 확인하세요.",
    "faq.q1": "몽골 여행 베스트 시즌은?",
    "faq.a1": "6–9월이 가장 인기입니다. 루트/날씨에 따라 비성수기도 좋습니다.",
    "faq.q2": "프라이빗 vs 그룹 투어?",
    "faq.a2":
      "프라이빗은 유연하고, 그룹은 비용이 합리적입니다. 둘 다 가능합니다.",
    "faq.q3": "한국어/영어 가이드가 있나요?",
    "faq.a3": "네. 성수기에는 조기 예약을 추천합니다.",
    "faq.q4": "패키지에 무엇이 포함되나요?",
    "faq.a4":
      "일반적으로 차량+기사, 유류, 숙박, 일정 지원이 포함됩니다. 식사/가이드는 상품별 상이합니다.",

    "contact.h2": "문의",
    "contact.p":
      "날짜, 여행지, 인원, 원하는 편안함 수준을 알려주세요. 옵션으로 답변드립니다.",
    "contact.officeT": "오피스",
    "contact.officeP": "울란바토르, 몽골",
    "contact.phoneT": "전화",
    "contact.emailT": "이메일",
    "contact.formT": "견적 요청",
    "contact.name": "이름",
    "contact.email": "이메일",
    "contact.msg": "메시지",
    "contact.send": "보내기",

    "footer.tagline": "몽골 투어 • 차량/기사 • 가이드 • 캠프 • 맞춤 루트",

    "ui.verified": "검증된 여행자",
    "ui.from": "최저",
    "ui.book": "요청",
    "ui.topMatches": "추천 옵션",
    "ui.noMatch":
      "정확한 결과가 없습니다. 더 넓은 여행지(예: “고비”)로 검색하거나 스타일을 “전체”로 선택해 보세요.",
    "ui.formReady":
      "메시지가 준비되었습니다. 이메일/카카오톡/왓츠앱 연동으로 리드를 받을 수 있어요.",
    "ui.fillAll": "모든 항목을 입력해 주세요.",
  },
};

let currentLang = localStorage.getItem("lang") || "en";

// ================== Photo URLs ==================
const PHOTOS = {
  hero: "https://www.toursmongolia.com/uploads/Amazing_landscape_Tuul_river_bayar.jpg",
  dest: "https://www.toursmongolia.com/uploads/Amazing_landscape_khovsgol_lake_bayar.jpg",
  prov: "https://www.toursmongolia.com/uploads/Amazing_landscape_Gobi_desert_bayar.jpg",
  gobi: "https://www.toursmongolia.com/uploads/Amazing_landscape_Gobi_desert_bayar.jpg",
  khuvsgul:
    "https://www.toursmongolia.com/uploads/Amazing_landscape_khovsgol_lake_bayar.jpg",
  tuul: "https://www.toursmongolia.com/uploads/Amazing_landscape_Tuul_river_bayar.jpg",
  banner:
    "https://www.toursmongolia.com/uploads/Mongolia_travel_blog_news_ayantravel_cover.jpg",
};

// ================== Data (Destinations) ==================
const destinations = [
  {
    key: "gobi",
    img: "/img/gobi.jpg",
    en: {
      name: "Gobi Desert",
      tag: "Nature",
      highlight: "Khongor Dunes • Bayanzag",
      days: "5–8 days",
    },
    ko: {
      name: "고비 사막",
      tag: "자연",
      highlight: "홍고르 사구 • 바얀자그",
      days: "5–8일",
    },
  },

  {
    key: "khuvsgul",
    img: "/img/khuvsgul.jpg",
    en: {
      name: "Khuvsgul Lake",
      tag: "Nature",
      highlight: "Lake views • Forest",
      days: "4–7 days",
    },
    ko: {
      name: "홉스골 호수",
      tag: "자연",
      highlight: "호수 전망 • 숲",
      days: "4–7일",
    },
  },

  {
    key: "terelj",
    img: "/img/terelj.jpg",
    en: {
      name: "Terelj National Park",
      tag: "Family",
      highlight: "Easy trip • Near UB",
      days: "1–3 days",
    },
    ko: {
      name: "테렐지 국립공원",
      tag: "가족",
      highlight: "가벼운 일정 • 울란바토르 근교",
      days: "1–3일",
    },
  },

  {
    key: "kharkhorin",
    img: "/img/kharkhorin.jpg",
    en: {
      name: "Kharkhorin",
      tag: "Culture",
      highlight: "Erdene Zuu • History",
      days: "2–4 days",
    },
    ko: {
      name: "하르호린",
      tag: "문화",
      highlight: "에르덴 조 • 역사",
      days: "2–4일",
    },
  },
];
// ================== 21 Provinces (Aimags) ==================
const provinces = [
  { en: "Arkhangai", ko: "아르항가이" },
  { en: "Bayan-Ulgii", ko: "바양-올기" },
  { en: "Bayankhongor", ko: "바양홍고르" },
  { en: "Bulgan", ko: "불간" },
  { en: "Darkhan-Uul", ko: "다르항-울" },
  { en: "Dornod", ko: "도르노드" },
  { en: "Dornogovi", ko: "도르노고비" },
  { en: "Dundgovi", ko: "둔드고비" },
  { en: "Govi-Altai", ko: "고비-알타이" },
  { en: "Govisumber", ko: "고비스움베르" },
  { en: "Khentii", ko: "헨티" },
  { en: "Khovd", ko: "호브드" },
  { en: "Khuvsgul", ko: "홉스골" },
  { en: "Umnugovi", ko: "옴노고비" },
  { en: "Orkhon", ko: "오르혼" },
  { en: "Uvurkhangai", ko: "오버르항가이" },
  { en: "Selenge", ko: "셀렝게" },
  { en: "Sukhbaatar", ko: "수흐바타르" },
  { en: "Tuv", ko: "토브" },
  { en: "Uvs", ko: "우브스" },
  { en: "Zavkhan", ko: "자브항" },
];
const PROVINCE_IMAGES = {
  "Arkhangai": "/img/arkhangai.jpg",
  "Bayan-Ulgii": "/img/bayan-ulgii.jpg",
  "Bayankhongor": "/img/bayankhongor.jpg",
  "Bulgan": "/img/bulgan.jpg",
  "Darkhan-Uul": "/img/darkhan.jpg",
  "Dornod": "/img/dornod.jpg",
  "Dornogovi": "/img/dornogovi.jpg",
  "Dundgovi": "/img/dundgovi.jpg",
  "Govi-Altai": "/img/govi-altai.jpg",
  "Govisumber": "/img/govisumber.jpg",
  "Khentii": "/img/khentii.jpg",
  "Khovd": "/img/khovd.jpg",
  "Khuvsgul": "/img/khuvsgul.jpg",
  "Umnugovi": "/img/umnugovi.jpg",
  "Orkhon": "/img/orkhon.jpg",
  "Uvurkhangai": "/img/uvurkhangai.jpg",
  "Selenge": "/img/selenge.jpg",
  "Sukhbaatar": "/img/sukhbaatar.jpg",
  "Tuv": "/img/tuv.jpg",
  "Uvs": "/img/uvs.jpg",
  "Zavkhan": "/img/zavkhan.jpg",
};

// ================== Packages / Reviews ==================
const packages = [
  {
    id: 1,
    type: "nature",
    level: "mid",
    price: 980,
    en: {
      title: "Gobi Highlights",
      place: "Gobi",
      duration: "6 nights",
      badge: "Best seller",
    },
    ko: {
      title: "고비 핵심 코스",
      place: "고비",
      duration: "6박",
      badge: "베스트",
    },
  },

  {
    id: 2,
    type: "family",
    level: "budget",
    price: 190,
    en: {
      title: "Terelj Day Trip",
      place: "Terelj",
      duration: "1 day",
      badge: "Easy",
    },
    ko: {
      title: "테렐지 당일치기",
      place: "테렐지",
      duration: "당일",
      badge: "간편",
    },
  },

  {
    id: 3,
    type: "culture",
    level: "mid",
    price: 520,
    en: {
      title: "Kharkhorin + Orkhon",
      place: "Central Mongolia",
      duration: "3 nights",
      badge: "Culture",
    },
    ko: {
      title: "하르호린 + 오르혼",
      place: "중앙 몽골",
      duration: "3박",
      badge: "문화",
    },
  },

  {
    id: 4,
    type: "nature",
    level: "mid",
    price: 640,
    en: {
      title: "Khuvsgul Lake Escape",
      place: "Khuvsgul",
      duration: "4 nights",
      badge: "Nature",
    },
    ko: {
      title: "홉스골 호수 힐링",
      place: "홉스골",
      duration: "4박",
      badge: "자연",
    },
  },

  {
    id: 5,
    type: "adventure",
    level: "lux",
    price: 1790,
    en: {
      title: "Altai Trek & Nomad Camp",
      place: "Altai",
      duration: "8 nights",
      badge: "Premium",
    },
    ko: {
      title: "알타이 트레킹 & 캠프",
      place: "알타이",
      duration: "8박",
      badge: "프리미엄",
    },
  },

  {
    id: 6,
    type: "adventure",
    level: "mid",
    price: 1490,
    en: {
      title: "Eagle Hunter Experience",
      place: "Bayan-Ölgii",
      duration: "7 nights",
      badge: "Adventure",
    },
    ko: {
      title: "독수리 사냥꾼 체험",
      place: "바양-올기",
      duration: "7박",
      badge: "어드벤처",
    },
  },
];

const reviews = [
  {
    stars: 5,
    en: {
      name: "Ariunaa",
      text: "Fast communication and a very safe driver. The Gobi route was perfectly planned.",
    },
    ko: {
      name: "아리우나",
      text: "연락이 빠르고 기사님이 정말 안전하게 운전해 주셨어요. 고비 일정이 완벽했습니다.",
    },
  },
  {
    stars: 5,
    en: {
      name: "Minsoo",
      text: "Korean guide was super helpful. Terelj was beautiful and easy for family.",
    },
    ko: {
      name: "민수",
      text: "한국어 가이드가 정말 도움이 됐어요. 테렐지는 가족 여행으로 딱 좋았습니다.",
    },
  },
  {
    stars: 4,
    en: {
      name: "Sarah",
      text: "Great camp selections and flexible schedule. Would book again.",
    },
    ko: {
      name: "사라",
      text: "캠프 선택이 좋고 일정도 유연했어요. 다음에 또 예약할게요.",
    },
  },
];

// ================== Helpers ==================
const $ = (sel, parent = document) => parent.querySelector(sel);
const $$ = (sel, parent = document) => [...parent.querySelectorAll(sel)];

function t(key) {
  return (I18N[currentLang] && I18N[currentLang][key]) || I18N.en[key] || key;
}
function stars(n) {
  return "★".repeat(n) + "☆".repeat(Math.max(0, 5 - n));
}
function money(n) {
  return `$${n}`;
} // demo currency

// ================== i18n apply + photo vars ==================
function applyI18n() {
  document.documentElement.lang = currentLang === "ko" ? "ko" : "en";

  $$("[data-i18n]").forEach((el) => {
    const key = el.getAttribute("data-i18n");
    el.textContent = t(key);
  });

  // placeholders
  $("#qDestination").placeholder =
    currentLang === "ko"
      ? "고비, 홉스골, 알타이..."
      : "Gobi, Khuvsgul, Altai...";
  $("#cName").placeholder = currentLang === "ko" ? "이름" : "Your name";
  $("#cMsg").placeholder =
    currentLang === "ko"
      ? "날짜, 여행지, 인원, 예산..."
      : "Dates, destinations, travelers, budget...";
  $("#provSearch").placeholder =
    currentLang === "ko" ? "주(아이막) 검색..." : "Search province...";

  // set page background photos
  document.documentElement.style.setProperty(
    "--hero-img",
    `url("${PHOTOS.hero}")`,
  );
  document.documentElement.style.setProperty(
    "--dest-img",
    `url("${PHOTOS.dest}")`,
  );
  document.documentElement.style.setProperty(
    "--prov-img",
    `url("${PHOTOS.prov}")`,
  );

  renderDestinations();
  renderProvinces();
  renderPackages();
  renderReview();
}

// ================== Render Destinations ==================
function renderDestinations() {
  const grid = $("#destGrid");
  grid.innerHTML = destinations
    .map((d) => {
      const x = d[currentLang];
      return `
      <article class="card">
        <div class="card-media" style="background-image:url('${d.img}')">
          <span class="card-badge">${x.tag}</span>
        </div>
        <h3>${x.name}</h3>
        <div class="meta">
          <span>${x.highlight}</span>
          <span>${x.days}</span>
        </div>
      </article>
    `;
    })
    .join("");
}

// ================== Render 21 Provinces ==================
function renderProvinces() {
  const q = ($("#provSearch").value || "").trim().toLowerCase();

  const list = provinces.filter((p) => {
    const name = (currentLang === "ko" ? p.ko : p.en).toLowerCase();
    const en = p.en.toLowerCase();
    return !q || name.includes(q) || en.includes(q);
  });

  const grid = $("#provGrid");
  grid.innerHTML = list
    .map((p) => {
      const img = PROVINCE_IMAGES[p.en] || "/img/default.jpg"; // fallback зураг
      const badge = currentLang === "ko" ? "아이막" : "Aimag";
      const title = currentLang === "ko" ? p.ko : p.en;

      return `
      <article class="card">
        <div class="card-media" style="background-image:url('${img}')">
          <span class="card-badge">${badge}</span>
        </div>
        <h3>${title}</h3>
        <div class="meta">
          <span class="muted">${p.en}</span>
          <span class="muted">—</span>
        </div>
      </article>
    `;
    })
    .join("");
}


// ================== Render Packages ==================
let currentFilter = "all";
function renderPackages() {
  const grid = $("#pkgGrid");
  const filtered =
    currentFilter === "all"
      ? packages
      : packages.filter((p) => p.type === currentFilter);

  grid.innerHTML = filtered
    .map((p) => {
      const x = p[currentLang];
      return `
      <article class="card" data-type="${p.type}">
        <div class="card-media" style="background-image:url('${PHOTOS.prov}')">
          <span class="card-badge">${x.badge}</span>
        </div>
        <h3>${x.title}</h3>
        <div class="meta">
          <span>${x.place}</span>
          <span>${x.duration} • ${p.level.toUpperCase()}</span>
        </div>
        <div class="price">
          <strong>${money(p.price)}</strong>
          <a class="btn btn-small" href="#contact" data-pkg="${x.title}">${t("ui.book")}</a>
        </div>
      </article>
    `;
    })
    .join("");

  $$("a[data-pkg]").forEach((a) => {
    a.addEventListener("click", () => {
      $("#cMsg").value =
        currentLang === "ko"
          ? `안녕하세요! 아래 패키지에 관심 있어요: ${a.dataset.pkg}\n출발일:\n인원:\n예산:\n추가 요청:`
          : `Hi! I'm interested in: ${a.dataset.pkg}\nStart date:\nTravelers:\nBudget:\nNotes:`;
    });
  });
}

// ================== Filters ==================
function setupFilters() {
  $$(".chip").forEach((btn) => {
    btn.addEventListener("click", () => {
      $$(".chip").forEach((b) => b.classList.remove("is-active"));
      btn.classList.add("is-active");
      currentFilter = btn.dataset.filter;
      renderPackages();
    });
  });
}

// ================== Reviews ==================
let reviewIndex = 0;
function renderReview() {
  const r = reviews[reviewIndex];
  const x = r[currentLang];
  $("#reviewBox").innerHTML = `
    <div class="review-top">
      <div>
        <div class="review-name">${x.name}</div>
        <div class="muted small">${t("ui.verified")}</div>
      </div>
      <div class="stars" aria-label="${r.stars} out of 5">${stars(r.stars)}</div>
    </div>
    <p>${x.text}</p>
  `;
}
function setupReviewSlider() {
  $("#prevReview").addEventListener("click", () => {
    reviewIndex = (reviewIndex - 1 + reviews.length) % reviews.length;
    renderReview();
  });
  $("#nextReview").addEventListener("click", () => {
    reviewIndex = (reviewIndex + 1) % reviews.length;
    renderReview();
  });
}

// ================== FAQ Accordion ==================
function setupAccordion() {
  $$("#faqAcc .acc-q").forEach((btn) => {
    btn.addEventListener("click", () => {
      const item = btn.closest(".acc-item");
      const answer = item.querySelector(".acc-a");
      const expanded = btn.getAttribute("aria-expanded") === "true";

      $$("#faqAcc .acc-q").forEach((other) => {
        if (other !== btn) {
          other.setAttribute("aria-expanded", "false");
          const it = other.closest(".acc-item");
          it.querySelector(".acc-a").style.maxHeight = 0;
          it.querySelector(".acc-icon").textContent = "+";
        }
      });

      btn.setAttribute("aria-expanded", String(!expanded));
      answer.style.maxHeight = !expanded ? `${answer.scrollHeight}px` : 0;
      item.querySelector(".acc-icon").textContent = !expanded ? "−" : "+";
    });
  });
}

// ================== Mobile Menu ==================
function setupMobileMenu() {
  const toggle = $("#navToggle");
  const list = $("#navList");

  toggle.addEventListener("click", () => {
    const open = list.classList.toggle("is-open");
    toggle.setAttribute("aria-expanded", String(open));
  });

  $$(".nav-link").forEach((link) => {
    link.addEventListener("click", () => {
      list.classList.remove("is-open");
      toggle.setAttribute("aria-expanded", "false");
    });
  });
}

// ================== Search ==================
function setupSearch() {
  $("#searchForm").addEventListener("submit", (e) => {
    e.preventDefault();
    const dest = $("#qDestination").value.trim().toLowerCase();
    const style = $("#qStyle").value;
    const date = $("#qDate").value;

    const matches = packages
      .filter((p) => {
        const title = p[currentLang].title.toLowerCase();
        const place = p[currentLang].place.toLowerCase();
        const byDest = !dest || title.includes(dest) || place.includes(dest);
        const byStyle =
          style === "any" ||
          (style === "budget" && p.level === "budget") ||
          (style === "mid" && p.level === "mid") ||
          (style === "lux" && p.level === "lux");
        return byDest && byStyle;
      })
      .slice(0, 3);

    const box = $("#searchResult");
    if (!matches.length) {
      box.innerHTML = `<p class="muted small">${t("ui.noMatch")}</p>`;
      return;
    }

    box.innerHTML = `
      <div class="muted small">${t("ui.topMatches")}${date ? ` (${date})` : ""}:</div>
      ${matches
        .map(
          (m) => `
        <div class="card" style="padding:.8rem;">
          <div style="display:flex; justify-content:space-between; gap:.7rem; flex-wrap:wrap;">
            <strong>${m[currentLang].title}</strong>
            <span class="muted small">${m[currentLang].place} • ${m[currentLang].duration}</span>
          </div>
          <div style="display:flex; justify-content:space-between; align-items:center; gap:.7rem; margin-top:.5rem;">
            <span class="muted small">${t("ui.from")} <strong>${money(m.price)}</strong></span>
            <a class="btn btn-small" href="#contact" data-pkg="${m[currentLang].title}">${t("ui.book")}</a>
          </div>
        </div>
      `,
        )
        .join("")}
    `;
  });
}

// ================== Contact ==================
function setupContact() {
  $("#contactForm").addEventListener("submit", (e) => {
    e.preventDefault();
    const name = $("#cName").value.trim();
    const email = $("#cEmail").value.trim();
    const msg = $("#cMsg").value.trim();
    const hint = $("#contactHint");

    if (!name || !email || !msg) {
      hint.textContent = t("ui.fillAll");
      hint.style.color = "crimson";
      return;
    }
    hint.textContent = t("ui.formReady");
    hint.style.color = "green";
    e.target.reset();
  });
}

// ================== Provinces search ==================
function setupProvinceSearch() {
  $("#provSearch").addEventListener("input", renderProvinces);
}

// ================== Back to top ==================
function setupToTop() {
  const btn = $("#toTop");
  window.addEventListener("scroll", () => {
    btn.style.display = window.scrollY > 700 ? "grid" : "none";
  });
  btn.addEventListener("click", () =>
    window.scrollTo({ top: 0, behavior: "smooth" }),
  );
}

// ================== Language Toggle ==================
function setupLang() {
  const buttons = $$(".lang-btn");
  buttons.forEach((b) => {
    b.addEventListener("click", () => {
      buttons.forEach((x) => x.classList.remove("is-active"));
      b.classList.add("is-active");
      currentLang = b.dataset.lang;
      localStorage.setItem("lang", currentLang);
      applyI18n();
    });
  });
  buttons.forEach((x) =>
    x.classList.toggle("is-active", x.dataset.lang === currentLang),
  );
}

// ================== Init ==================
document.addEventListener("DOMContentLoaded", () => {
  $("#year").textContent = new Date().getFullYear();

  setupMobileMenu();
  setupFilters();
  setupReviewSlider();
  setupAccordion();
  setupSearch();
  setupContact();
  setupProvinceSearch();
  setupToTop();
  setupLang();

  applyI18n();
});
